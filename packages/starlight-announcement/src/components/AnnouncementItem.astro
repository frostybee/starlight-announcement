---
import type { AnnouncementConfig } from '../schemas/config';

interface Props {
  announcement: AnnouncementConfig;
}

const { announcement } = Astro.props;
const { id, content, link, variant, dismissible } = announcement;

const dismissLabel = Astro.locals.t('starlightAnnouncement.dismiss');
const learnMoreLabel = Astro.locals.t('starlightAnnouncement.learnMore');

// Variant icons (Lucide-style)
const icons = {
  note: '<circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>',
  tip: '<path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2z"/>',
  caution: '<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>',
  danger: '<polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>',
};
const iconPath = icons[variant as keyof typeof icons] || icons.note;
---

<div
  class="sl-announcement"
  data-announcement-id={id}
  data-variant={variant}
  role="status"
  aria-live="polite"
>
  <div class="sl-announcement-inner">
    <svg
      class="sl-announcement-icon"
      xmlns="http://www.w3.org/2000/svg"
      width="16"
      height="16"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      aria-hidden="true"
    >
      <Fragment set:html={iconPath} />
    </svg>
    <div class="sl-announcement-content">
      <span class="sl-announcement-text" set:html={content} />
      {link && (
        <a href={link.href} class="sl-announcement-link">
          <span>{link.text || learnMoreLabel}</span>
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      )}
    </div>
  </div>
  {dismissible && (
    <button
      type="button"
      class="sl-announcement-dismiss"
      data-dismiss-announcement={id}
      aria-label={dismissLabel}
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2.5"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  )}
</div>

<style>
  .sl-announcement {
    --_bg: var(--sl-color-blue-low);
    --_border: var(--sl-color-blue);
    --_accent: var(--sl-color-blue-high);
    --_icon: var(--sl-color-blue);

    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.75rem;
    padding: 0.625rem 1rem;
    background: linear-gradient(
      135deg,
      var(--_bg) 0%,
      color-mix(in srgb, var(--_bg) 85%, transparent) 100%
    );
    border-bottom: 1px solid color-mix(in srgb, var(--_border) 40%, transparent);
    box-shadow: inset 0 -1px 0 color-mix(in srgb, var(--_border) 15%, transparent);
  }

  /* Left accent bar */
  .sl-announcement::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--_border);
    opacity: 0.9;
  }

  .sl-announcement[data-variant='tip'] {
    --_bg: var(--sl-color-green-low);
    --_border: var(--sl-color-green);
    --_accent: var(--sl-color-green-high);
    --_icon: var(--sl-color-green);
  }

  .sl-announcement[data-variant='caution'] {
    --_bg: var(--sl-color-orange-low);
    --_border: var(--sl-color-orange);
    --_accent: var(--sl-color-orange-high);
    --_icon: var(--sl-color-orange);
  }

  .sl-announcement[data-variant='danger'] {
    --_bg: var(--sl-color-red-low);
    --_border: var(--sl-color-red);
    --_accent: var(--sl-color-red-high);
    --_icon: var(--sl-color-red);
  }

  .sl-announcement-inner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.625rem;
    flex: 1;
    min-width: 0;
  }

  .sl-announcement-icon {
    flex-shrink: 0;
    color: var(--_icon);
    opacity: 0.9;
  }

  .sl-announcement-content {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 0.375rem 0.75rem;
    font-size: var(--sl-text-sm);
    line-height: 1.5;
  }

  .sl-announcement-text {
    color: var(--sl-color-white);
  }

  .sl-announcement-link {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.125rem 0.5rem;
    border-radius: 1rem;
    background: color-mix(in srgb, var(--_border) 25%, transparent);
    color: var(--_accent);
    font-size: var(--sl-text-xs);
    font-weight: 600;
    text-decoration: none;
    letter-spacing: 0.01em;
    transition: all 0.15s ease;
  }

  .sl-announcement-link svg {
    transition: transform 0.15s ease;
  }

  .sl-announcement-link:hover {
    background: color-mix(in srgb, var(--_border) 40%, transparent);
    color: var(--sl-color-white);
  }

  .sl-announcement-link:hover svg {
    transform: translateX(2px);
  }

  .sl-announcement-dismiss {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1.5rem;
    height: 1.5rem;
    padding: 0;
    background: transparent;
    border: none;
    border-radius: 0.25rem;
    color: color-mix(in srgb, var(--sl-color-white) 50%, transparent);
    cursor: pointer;
    transition: all 0.15s ease;
  }

  .sl-announcement-dismiss:hover {
    color: var(--sl-color-white);
    background: color-mix(in srgb, var(--_border) 50%, transparent);
  }

  .sl-announcement-dismiss:focus-visible {
    outline: 2px solid var(--_accent);
    outline-offset: 2px;
  }

  .sl-announcement-dismiss:active {
    transform: scale(0.92);
  }
</style>
